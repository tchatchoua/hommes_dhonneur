import{a as ue}from"./chunk-ID5W2Q5Y.js";import{a as _e}from"./chunk-66DYWRGA.js";import{F as pe,a as ce,b as me,i as de,k as fe,w as ge}from"./chunk-X5J6KBJZ.js";import{$ as k,A as l,Aa as H,B as w,Ba as q,C as T,Ca as G,D as N,Da as J,E as h,Ea as K,F as x,G as S,Ga as Q,Ha as X,I as E,Ja as Y,K as F,Ma as Z,N as O,Na as $,P as V,Pa as ee,Qa as te,Ta as ie,Ua as ne,Xa as oe,Za as ae,_a as re,ba as W,bb as se,cb as le,ga as L,h as f,i as g,j as u,ka as B,l as s,m as y,n as A,o as M,p,pa as D,qa as R,r as P,ra as z,s as v,t as b,u as i,v as n,w as d,x as I,xa as j,y as _,z as c,za as U}from"./chunk-CLQQFUUR.js";import"./chunk-B5Q7V33N.js";import"./chunk-7KGURMOZ.js";import"./chunk-MEY4KOAF.js";import"./chunk-K4BOZHCE.js";import"./chunk-VKOJ4YFE.js";import"./chunk-URA66MOF.js";import"./chunk-R5HL6L5F.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-L7HKPRYE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{e as C}from"./chunk-JHI3MBHO.js";var he=(o,m)=>m.id;function Se(o,m){o&1&&(i(0,"div",2),d(1,"ion-spinner",8),i(2,"p"),l(3,"Loading notifications..."),n()())}function Ce(o,m){if(o&1){let e=I();i(0,"div",3),d(1,"ion-icon",9),i(2,"h3"),l(3,"No Notifications"),n(),i(4,"p"),l(5,"Send a notification to users"),n(),i(6,"ion-button",5),_("click",function(){f(e);let t=c();return g(t.openAddModal())}),d(7,"ion-icon",10),l(8," Send Notification "),n()()}}function ye(o,m){if(o&1&&(i(0,"ion-item"),d(1,"ion-icon",12),i(2,"ion-label")(3,"h2"),l(4),n(),i(5,"p"),l(6),n(),i(7,"p",13),l(8),E(9,"date"),n()(),i(10,"ion-badge",14),l(11),n()()),o&2){let e=m.$implicit,a=c(2);s(),p("name",e.isSent?"checkmark-done-outline":"time-outline")("color",e.isSent?"medium":"primary"),s(3),w(e.type),s(2),w(e.message),s(2),N(" User ID: ",e.userId," \u2022 ",F(9,8,e.notificationDate,"medium")," "),s(2),p("color",a.getTypeColor(e.type)),s(),T(" ",e.isSent?"Sent":"Pending"," ")}}function Me(o,m){if(o&1){let e=I();i(0,"ion-list"),v(1,ye,12,11,"ion-item",null,he),n(),i(3,"ion-infinite-scroll",11),_("ionInfinite",function(t){f(e);let r=c();return g(r.loadMore(t))}),d(4,"ion-infinite-scroll-content"),n()}if(o&2){let e=c();s(),b(e.notifications())}}function Ie(o,m){o&1&&d(0,"ion-spinner",8)}function Pe(o,m){o&1&&l(0," Send ")}function ve(o,m){if(o&1&&(i(0,"ion-select-option",20),l(1),n()),o&2){let e=m.$implicit;p("value",e.id),s(),N(" ",e.firstName," ",e.lastName," ")}}function be(o,m){if(o&1){let e=I();i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",5),_("click",function(){f(e);let t=c();return g(t.closeModal())}),d(4,"ion-icon",15),n()(),i(5,"ion-title"),l(6,"Send Notification"),n(),i(7,"ion-buttons",16)(8,"ion-button",17),_("click",function(){f(e);let t=c();return g(t.sendNotification())}),M(9,Ie,1,0,"ion-spinner",8)(10,Pe,1,0),n()()()(),i(11,"ion-content",18)(12,"ion-list")(13,"ion-item")(14,"ion-select",19),S("ngModelChange",function(t){f(e);let r=c();return x(r.notificationForm.userId,t)||(r.notificationForm.userId=t),g(t)}),i(15,"ion-select-option",20),l(16,"All Users"),n(),v(17,ve,2,3,"ion-select-option",20,he),n()(),i(19,"ion-item")(20,"ion-select",21),S("ngModelChange",function(t){f(e);let r=c();return x(r.notificationForm.type,t)||(r.notificationForm.type=t),g(t)}),i(21,"ion-select-option",22),l(22,"Info"),n(),i(23,"ion-select-option",23),l(24,"Warning"),n(),i(25,"ion-select-option",24),l(26,"Reminder"),n(),i(27,"ion-select-option",25),l(28,"Alert"),n()()(),i(29,"ion-item")(30,"ion-input",26),S("ngModelChange",function(t){f(e);let r=c();return x(r.notificationForm.title,t)||(r.notificationForm.title=t),g(t)}),n()(),i(31,"ion-item")(32,"ion-textarea",27),S("ngModelChange",function(t){f(e);let r=c();return x(r.notificationForm.message,t)||(r.notificationForm.message=t),g(t)}),n()()()()}if(o&2){let e=c();s(8),p("disabled",e.isSaving()),s(),P(e.isSaving()?9:10),s(5),h("ngModel",e.notificationForm.userId),s(),p("value",0),s(2),b(e.users()),s(3),h("ngModel",e.notificationForm.type),s(10),h("ngModel",e.notificationForm.title),s(2),h("ngModel",e.notificationForm.message),p("rows",4)}}var Re=(()=>{class o{notificationService;userService;toastController;notifications=u([]);users=u([]);isLoading=u(!0);isSaving=u(!1);isModalOpen=u(!1);currentPage=1;pageSize=20;hasMore=!0;notificationForm={userId:0,type:"Info",title:"",message:""};constructor(e,a,t){this.notificationService=e,this.userService=a,this.toastController=t,ce({addOutline:me,notificationsOutline:ge,closeOutline:fe,checkmarkDoneOutline:de,timeOutline:pe})}ngOnInit(){this.loadNotifications(),this.loadUsers()}loadNotifications(e=!1){e||(this.isLoading.set(!0),this.currentPage=1),this.notificationService.getAll(this.currentPage,this.pageSize).subscribe({next:a=>{if(a.success&&a.data){let t=a.data.items;e?this.notifications.update(r=>[...r,...t]):this.notifications.set(t),this.hasMore=t.length===this.pageSize}this.isLoading.set(!1)},error:()=>{this.isLoading.set(!1)}})}loadUsers(){this.userService.getAll().subscribe({next:e=>{e.success&&e.data&&this.users.set(e.data)}})}loadMore(e){if(!this.hasMore){e.target.complete();return}this.currentPage++,this.notificationService.getAll(this.currentPage,this.pageSize).subscribe({next:a=>{if(a.success&&a.data){let t=a.data.items;this.notifications.update(r=>[...r,...t]),this.hasMore=t.length===this.pageSize}e.target.complete()},error:()=>{e.target.complete()}})}refresh(e){this.loadNotifications(),setTimeout(()=>{e.target.complete()},1e3)}getTypeColor(e){switch(e){case"Warning":return"warning";case"Alert":return"danger";case"Reminder":return"tertiary";default:return"primary"}}openAddModal(){this.notificationForm={userId:0,type:"Info",title:"",message:""},this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1)}sendNotification(){return C(this,null,function*(){if(!this.notificationForm.title.trim()||!this.notificationForm.message.trim()){yield(yield this.toastController.create({message:"Please fill in title and message",duration:2e3,color:"warning"})).present();return}this.isSaving.set(!0),this.notificationService.create({userId:this.notificationForm.userId||void 0,message:this.notificationForm.message,type:this.notificationForm.type}).subscribe({next:e=>C(this,null,function*(){this.isSaving.set(!1),e.success&&(this.closeModal(),this.loadNotifications(),yield(yield this.toastController.create({message:"Notification sent successfully",duration:2e3,color:"success"})).present())}),error:()=>C(this,null,function*(){this.isSaving.set(!1),yield(yield this.toastController.create({message:"Failed to send notification",duration:2e3,color:"danger"})).present()})})})}static \u0275fac=function(a){return new(a||o)(y(ue),y(_e),y(oe))};static \u0275cmp=A({type:o,selectors:[["app-admin-notifications"]],decls:17,vars:2,consts:[["slot","start"],["slot","fixed",3,"ionRefresh"],[1,"loading-container"],[1,"empty-state"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click"],["name","add-outline"],[3,"didDismiss","isOpen"],["name","crescent"],["name","notifications-outline"],["slot","start","name","add-outline"],[3,"ionInfinite"],["slot","start",3,"name","color"],[1,"meta"],["slot","end",3,"color"],["slot","icon-only","name","close-outline"],["slot","end"],[3,"click","disabled"],[1,"ion-padding"],["label","Recipient","labelPlacement","floating","placeholder","Select user",3,"ngModelChange","ngModel"],[3,"value"],["label","Type","labelPlacement","floating",3,"ngModelChange","ngModel"],["value","Info"],["value","Warning"],["value","Reminder"],["value","Alert"],["type","text","label","Title","labelPlacement","floating","placeholder","Enter title",3,"ngModelChange","ngModel"],["label","Message","labelPlacement","floating","placeholder","Enter message",3,"ngModelChange","ngModel","rows"]],template:function(a,t){a&1&&(i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),d(3,"ion-menu-button"),n(),i(4,"ion-title"),l(5,"Notifications"),n()()(),i(6,"ion-content")(7,"ion-refresher",1),_("ionRefresh",function(xe){return t.refresh(xe)}),d(8,"ion-refresher-content"),n(),M(9,Se,4,0,"div",2)(10,Ce,9,0,"div",3)(11,Me,5,0),i(12,"ion-fab",4)(13,"ion-fab-button",5),_("click",function(){return t.openAddModal()}),d(14,"ion-icon",6),n()(),i(15,"ion-modal",7),_("didDismiss",function(){return t.closeModal()}),M(16,be,33,8,"ng-template"),n()()),a&2&&(s(9),P(t.isLoading()&&t.notifications().length===0?9:t.notifications().length===0?10:11),s(6),p("isOpen",t.isModalOpen()))},dependencies:[V,O,L,k,W,q,ne,ie,j,X,K,Q,ae,D,R,te,Z,$,z,Y,U,H,B,re,le,se,ee,G,J],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:var(--ion-color-medium);margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0 0 24px}.meta[_ngcontent-%COMP%]{font-size:12px;margin-top:4px}"]})}return o})();export{Re as AdminNotificationsPage};
