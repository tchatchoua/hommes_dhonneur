import{a as Pt}from"./chunk-U3EEIW23.js";import{a as It}from"./chunk-74WUOWCQ.js";import{a as vt}from"./chunk-66DYWRGA.js";import{a as ht,b as xt,d as wt,g as yt,k as Mt,p as St}from"./chunk-X5J6KBJZ.js";import{a as ft}from"./chunk-BYLLDUDU.js";import{$ as j,A as s,Aa as Z,B as v,Ba as $,C as V,Ca as tt,D as W,Da as et,E as y,Ea as nt,F as M,G as S,Ga as it,Ha as ot,I as P,J as k,Ja as rt,K as A,Ma as at,N as F,Na as lt,O as L,P as N,Pa as st,Qa as ct,Ta as dt,Ua as mt,Xa as ut,Ya as _t,Za as gt,_a as pt,ba as z,bb as Ct,cb as bt,ga as R,h as u,i as _,j as p,ka as U,l as a,m as x,n as B,o as b,p as f,pa as Y,qa as H,r as I,ra as q,s as T,sa as G,t as E,ta as J,u as i,v as o,w as m,x as w,xa as K,y as C,ya as Q,z as d,za as X}from"./chunk-CLQQFUUR.js";import"./chunk-B5Q7V33N.js";import"./chunk-7KGURMOZ.js";import"./chunk-MEY4KOAF.js";import"./chunk-K4BOZHCE.js";import"./chunk-VKOJ4YFE.js";import"./chunk-URA66MOF.js";import"./chunk-R5HL6L5F.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-L7HKPRYE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{e as O}from"./chunk-JHI3MBHO.js";var D=(n,c)=>c.id;function Ot(n,c){n&1&&(i(0,"div",11),m(1,"ion-spinner",16),i(2,"p"),s(3,"Loading contributions..."),o()())}function Tt(n,c){if(n&1){let t=w();i(0,"div",12),m(1,"ion-icon",17),i(2,"h3"),s(3,"No Contributions Yet"),o(),i(4,"p"),s(5,"Start contributing to your community fund"),o(),i(6,"ion-button",2),C("click",function(){u(t);let e=d();return _(e.openAddModal())}),m(7,"ion-icon",18),s(8," Add Contribution "),o()()}}function Et(n,c){if(n&1&&(i(0,"ion-badge",23),s(1),o()),n&2){let t=d().$implicit;a(),V(" ",t.categoryName," ")}}function Vt(n,c){if(n&1&&(i(0,"ion-item"),m(1,"ion-icon",20),i(2,"ion-label")(3,"h2"),s(4),P(5,"currency"),o(),i(6,"p"),s(7),o(),i(8,"p",21),m(9,"ion-icon",22),s(10),P(11,"date"),o()(),b(12,Et,2,1,"ion-badge",23),o()),n&2){let t=c.$implicit;a(4),v(k(5,4,t.amount)),a(3),v(t.description||"No description"),a(3),V(" ",A(11,6,t.date,"mediumDate")," "),a(2),I(t.categoryName?12:-1)}}function kt(n,c){if(n&1){let t=w();i(0,"ion-list"),T(1,Vt,13,9,"ion-item",null,D),o(),i(3,"ion-infinite-scroll",19),C("ionInfinite",function(e){u(t);let r=d();return _(r.loadMore(e))}),m(4,"ion-infinite-scroll-content"),o()}if(n&2){let t=d();a(),E(t.contributions())}}function Dt(n,c){n&1&&m(0,"ion-spinner",16)}function Bt(n,c){n&1&&s(0," Save ")}function Wt(n,c){if(n&1&&(i(0,"ion-select-option",28),s(1),o()),n&2){let t=c.$implicit;f("value",t.id),a(),W(" ",t.firstName," ",t.lastName," ")}}function At(n,c){if(n&1){let t=w();i(0,"ion-item")(1,"ion-select",32),S("ngModelChange",function(e){u(t);let r=d(2);return M(r.newContribution.userId,e)||(r.newContribution.userId=e),_(e)}),T(2,Wt,2,3,"ion-select-option",28,D),o()()}if(n&2){let t=d(2);a(),y("ngModel",t.newContribution.userId),a(),E(t.users())}}function Ft(n,c){if(n&1&&(i(0,"ion-select-option",28),s(1),o()),n&2){let t=c.$implicit;f("value",t.id),a(),V(" ",t.name," ")}}function Lt(n,c){if(n&1){let t=w();i(0,"ion-datetime",33),S("ngModelChange",function(e){u(t);let r=d(2);return M(r.newContribution.date,e)||(r.newContribution.date=e),_(e)}),o()}if(n&2){let t=d(2);y("ngModel",t.newContribution.date)}}function Nt(n,c){if(n&1){let t=w();i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",2),C("click",function(){u(t);let e=d();return _(e.closeModal())}),m(4,"ion-icon",24),o()(),i(5,"ion-title"),s(6,"Add Contribution"),o(),i(7,"ion-buttons",1)(8,"ion-button",25),C("click",function(){u(t);let e=d();return _(e.saveContribution())}),b(9,Dt,1,0,"ion-spinner",16)(10,Bt,1,0),o()()()(),i(11,"ion-content",4)(12,"ion-list"),b(13,At,4,1,"ion-item"),i(14,"ion-item")(15,"ion-input",26),S("ngModelChange",function(e){u(t);let r=d();return M(r.newContribution.amount,e)||(r.newContribution.amount=e),_(e)}),o()(),i(16,"ion-item")(17,"ion-select",27),S("ngModelChange",function(e){u(t);let r=d();return M(r.newContribution.categoryId,e)||(r.newContribution.categoryId=e),_(e)}),T(18,Ft,2,2,"ion-select-option",28,D),o()(),i(20,"ion-item")(21,"ion-label"),s(22,"Date"),o(),m(23,"ion-datetime-button",29),o(),i(24,"ion-modal",30),b(25,Lt,1,1,"ng-template"),o(),i(26,"ion-item")(27,"ion-textarea",31),S("ngModelChange",function(e){u(t);let r=d();return M(r.newContribution.description,e)||(r.newContribution.description=e),_(e)}),o()()()()}if(n&2){let t=d();a(8),f("disabled",t.isSaving()),a(),I(t.isSaving()?9:10),a(4),I(t.authService.isAdmin()?13:-1),a(2),y("ngModel",t.newContribution.amount),a(2),y("ngModel",t.newContribution.categoryId),a(),E(t.categories()),a(6),f("keepContentsMounted",!0),a(3),y("ngModel",t.newContribution.description),f("rows",3)}}var ie=(()=>{class n{contributionService;categoryService;userService;authService;toastController;contributions=p([]);categories=p([]);users=p([]);isLoading=p(!0);isSaving=p(!1);isModalOpen=p(!1);totalContributions=p(0);thisMonthContributions=p(0);currentPage=1;pageSize=20;hasMore=!0;newContribution={userId:0,amount:0,categoryId:0,date:new Date().toISOString(),description:""};constructor(t,l,e,r,g){this.contributionService=t,this.categoryService=l,this.userService=e,this.authService=r,this.toastController=g,ht({addOutline:xt,cashOutline:yt,closeOutline:Mt,calendarOutline:wt,filterOutline:St})}ngOnInit(){this.loadContributions(),this.loadCategories(),this.authService.isAdmin()&&this.loadUsers()}loadUsers(){this.userService.getAll().subscribe({next:t=>{t.success&&t.data&&this.users.set(t.data)}})}loadContributions(t=!1){t||(this.isLoading.set(!0),this.currentPage=1),this.contributionService.getMyContributions().subscribe({next:l=>{if(l.success&&l.data){let e=l.data;t?this.contributions.update(r=>[...r,...e]):(this.contributions.set(e),this.calculateTotals(e)),this.hasMore=!1}this.isLoading.set(!1)},error:()=>{this.isLoading.set(!1)}})}loadCategories(){this.categoryService.getAll().subscribe({next:t=>{t.success&&t.data&&this.categories.set(t.data)}})}calculateTotals(t){let l=t.reduce((g,h)=>g+h.amount,0);this.totalContributions.set(l);let e=new Date,r=t.filter(g=>{let h=new Date(g.date);return h.getMonth()===e.getMonth()&&h.getFullYear()===e.getFullYear()}).reduce((g,h)=>g+h.amount,0);this.thisMonthContributions.set(r)}loadMore(t){t.target.complete()}refresh(t){this.loadContributions(),setTimeout(()=>{t.target.complete()},1e3)}toggleFilter(){}openAddModal(){this.resetNewContribution(),this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1)}resetNewContribution(){this.newContribution={userId:0,amount:0,categoryId:0,date:new Date().toISOString(),description:""}}saveContribution(){return O(this,null,function*(){if(!this.newContribution.amount||!this.newContribution.categoryId){yield(yield this.toastController.create({message:"Please fill in required fields",duration:2e3,color:"warning"})).present();return}if(this.authService.isAdmin()&&!this.newContribution.userId){yield(yield this.toastController.create({message:"Please select a member",duration:2e3,color:"warning"})).present();return}this.isSaving.set(!0),this.contributionService.create({userId:this.newContribution.userId||this.authService.currentUser()?.id||0,amount:this.newContribution.amount,categoryId:this.newContribution.categoryId,date:new Date(this.newContribution.date),description:this.newContribution.description}).subscribe({next:t=>O(this,null,function*(){this.isSaving.set(!1),t.success&&(this.closeModal(),this.loadContributions(),yield(yield this.toastController.create({message:"Contribution added successfully",duration:2e3,color:"success"})).present())}),error:()=>O(this,null,function*(){this.isSaving.set(!1),yield(yield this.toastController.create({message:"Failed to add contribution",duration:2e3,color:"danger"})).present()})})})}static \u0275fac=function(l){return new(l||n)(x(It),x(Pt),x(vt),x(ft),x(ut))};static \u0275cmp=B({type:n,selectors:[["app-contributions"]],decls:36,vars:8,consts:[["slot","start"],["slot","end"],[3,"click"],["slot","icon-only","name","filter-outline"],[1,"ion-padding"],["slot","fixed",3,"ionRefresh"],[1,"summary-card"],[1,"summary-content"],[1,"summary-item"],[1,"label"],[1,"value"],[1,"loading-container"],[1,"empty-state"],["slot","fixed","vertical","bottom","horizontal","end"],["name","add-outline"],[3,"didDismiss","isOpen"],["name","crescent"],["name","cash-outline"],["slot","start","name","add-outline"],[3,"ionInfinite"],["name","cash-outline","slot","start","color","success"],[1,"meta"],["name","calendar-outline"],["slot","end","color","primary"],["slot","icon-only","name","close-outline"],[3,"click","disabled"],["type","number","label","Amount","labelPlacement","floating","placeholder","Enter amount",3,"ngModelChange","ngModel"],["label","Category","labelPlacement","floating","placeholder","Select category",3,"ngModelChange","ngModel"],[3,"value"],["datetime","contribution-date"],[3,"keepContentsMounted"],["label","Description","labelPlacement","floating","placeholder","Add a description (optional)",3,"ngModelChange","ngModel","rows"],["label","Member","labelPlacement","floating","placeholder","Select member",3,"ngModelChange","ngModel"],["id","contribution-date","presentation","date",3,"ngModelChange","ngModel"]],template:function(l,e){l&1&&(i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),m(3,"ion-menu-button"),o(),i(4,"ion-title"),s(5,"My Contributions"),o(),i(6,"ion-buttons",1)(7,"ion-button",2),C("click",function(){return e.toggleFilter()}),m(8,"ion-icon",3),o()()()(),i(9,"ion-content",4)(10,"ion-refresher",5),C("ionRefresh",function(g){return e.refresh(g)}),m(11,"ion-refresher-content"),o(),i(12,"div",6)(13,"ion-card")(14,"ion-card-content")(15,"div",7)(16,"div",8)(17,"span",9),s(18,"Total Contributions"),o(),i(19,"span",10),s(20),P(21,"currency"),o()(),i(22,"div",8)(23,"span",9),s(24,"This Month"),o(),i(25,"span",10),s(26),P(27,"currency"),o()()()()()(),b(28,Ot,4,0,"div",11)(29,Tt,9,0,"div",12)(30,kt,5,0),i(31,"ion-fab",13)(32,"ion-fab-button",2),C("click",function(){return e.openAddModal()}),m(33,"ion-icon",14),o()(),i(34,"ion-modal",15),C("didDismiss",function(){return e.closeModal()}),b(35,Nt,28,8,"ng-template"),o()()),l&2&&(a(20),v(k(21,4,e.totalContributions())),a(6),v(k(27,6,e.thisMonthContributions())),a(2),I(e.isLoading()&&e.contributions().length===0?28:e.contributions().length===0?29:30),a(6),f("isOpen",e.isModalOpen()))},dependencies:[N,L,F,R,j,z,$,mt,dt,K,G,J,ot,nt,it,gt,Y,H,ct,at,lt,q,rt,X,Z,U,pt,bt,Ct,st,_t,Q,tt,et],styles:[".summary-card[_ngcontent-%COMP%]{margin-bottom:16px}.summary-card[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{margin:0}.summary-content[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.summary-item[_ngcontent-%COMP%]{text-align:center}.summary-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;font-size:12px;color:var(--ion-color-medium);margin-bottom:4px}.summary-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:var(--ion-color-success)}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:var(--ion-color-medium);margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0 0 24px}ion-item[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:12px;margin-top:4px}ion-item[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}"]})}return n})();export{ie as ContributionsPage};
