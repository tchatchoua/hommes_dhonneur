import{a as Ee}from"./chunk-U3EEIW23.js";import{a as Ie}from"./chunk-XXLWXVWG.js";import{a as Oe}from"./chunk-66DYWRGA.js";import{J as Me,a as De,b as Se,d as we,h as ye,k as Pe,p as ve}from"./chunk-X5J6KBJZ.js";import{a as xe}from"./chunk-BYLLDUDU.js";import{$ as N,A as s,Aa as Z,B as v,Ba as $,C as O,Ca as ee,D as W,Da as te,E as x,Ea as ne,F as D,G as S,Ga as ie,Ha as oe,I as M,J as E,Ja as ae,K as F,Ma as re,N as L,Na as le,O as A,Oa as se,P as z,Pa as ce,Qa as de,Ta as me,Ua as ue,Xa as ge,Ya as _e,Za as pe,_a as be,ab as fe,ba as j,bb as Ce,cb as he,ga as R,h as _,i as p,j as g,ka as U,l,m as w,n as B,o as C,p as b,pa as H,qa as Y,r as y,ra as q,s as T,sa as G,t as V,ta as J,u as i,v as o,w as u,x as P,xa as K,y as f,ya as Q,z as d,za as X}from"./chunk-CLQQFUUR.js";import"./chunk-B5Q7V33N.js";import"./chunk-7KGURMOZ.js";import"./chunk-MEY4KOAF.js";import"./chunk-K4BOZHCE.js";import"./chunk-VKOJ4YFE.js";import"./chunk-URA66MOF.js";import"./chunk-R5HL6L5F.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-L7HKPRYE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{e as h}from"./chunk-JHI3MBHO.js";var k=(n,c)=>c.id;function Te(n,c){n&1&&(i(0,"div",14),u(1,"ion-spinner",20),i(2,"p"),s(3,"Loading debts..."),o()())}function Ve(n,c){n&1&&s(0," You don't have any debts recorded ")}function ke(n,c){if(n&1&&s(0),n&2){let e=d(2);O(" No ",e.selectedStatus.toLowerCase()," debts ")}}function Be(n,c){if(n&1&&(i(0,"div",15),u(1,"ion-icon",21),i(2,"h3"),s(3,"No Debts Found"),o(),i(4,"p"),C(5,Ve,1,0)(6,ke,1,1),o()()),n&2){let e=d();l(5),y(e.selectedStatus==="all"?5:6)}}function We(n,c){if(n&1){let e=P();i(0,"ion-button",29),f("click",function(){_(e);let t=d().$implicit,r=d(2);return p(r.markAsPaid(t))}),u(1,"ion-icon",30),o()}}function Fe(n,c){if(n&1&&(i(0,"ion-item"),u(1,"ion-icon",23),i(2,"ion-label")(3,"h2"),s(4),M(5,"currency"),o(),i(6,"p"),s(7),o(),i(8,"p",24),u(9,"ion-icon",25),s(10),M(11,"date"),o()(),i(12,"div",26)(13,"ion-badge",27),s(14),o(),C(15,We,2,0,"ion-button",28),o()()),n&2){let e=c.$implicit,a=d(2);l(),b("color",a.getStatusColor(e.status)),l(3),v(E(5,7,e.amount)),l(3),v(e.description||"No description"),l(3),O(" Due: ",F(11,9,e.dueDate,"mediumDate")," "),l(3),b("color",a.getStatusColor(e.status)),l(),O(" ",e.status," "),l(),y(e.status==="Pending"?15:-1)}}function Le(n,c){if(n&1){let e=P();i(0,"ion-list"),T(1,Fe,16,12,"ion-item",null,k),o(),i(3,"ion-infinite-scroll",22),f("ionInfinite",function(t){_(e);let r=d();return p(r.loadMore(t))}),u(4,"ion-infinite-scroll-content"),o()}if(n&2){let e=d();l(),V(e.filteredDebts())}}function Ae(n,c){n&1&&u(0,"ion-spinner",20)}function ze(n,c){n&1&&s(0," Save ")}function Ne(n,c){if(n&1&&(i(0,"ion-select-option",36),s(1),o()),n&2){let e=c.$implicit;b("value",e.id),l(),W(" ",e.firstName," ",e.lastName," ")}}function je(n,c){if(n&1){let e=P();i(0,"ion-item")(1,"ion-select",40),S("ngModelChange",function(t){_(e);let r=d(2);return D(r.newDebt.userId,t)||(r.newDebt.userId=t),p(t)}),T(2,Ne,2,3,"ion-select-option",36,k),o()()}if(n&2){let e=d(2);l(),x("ngModel",e.newDebt.userId),l(),V(e.users())}}function Re(n,c){if(n&1&&(i(0,"ion-select-option",36),s(1),o()),n&2){let e=c.$implicit;b("value",e.id),l(),O(" ",e.name," ")}}function Ue(n,c){if(n&1){let e=P();i(0,"ion-datetime",41),S("ngModelChange",function(t){_(e);let r=d(2);return D(r.newDebt.dueDate,t)||(r.newDebt.dueDate=t),p(t)}),o()}if(n&2){let e=d(2);x("ngModel",e.newDebt.dueDate)}}function He(n,c){if(n&1){let e=P();i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",17),f("click",function(){_(e);let t=d();return p(t.closeModal())}),u(4,"ion-icon",31),o()(),i(5,"ion-title"),s(6,"Add Debt"),o(),i(7,"ion-buttons",32)(8,"ion-button",33),f("click",function(){_(e);let t=d();return p(t.saveDebt())}),C(9,Ae,1,0,"ion-spinner",20)(10,ze,1,0),o()()()(),i(11,"ion-content",5)(12,"ion-list"),C(13,je,4,1,"ion-item"),i(14,"ion-item")(15,"ion-input",34),S("ngModelChange",function(t){_(e);let r=d();return D(r.newDebt.amount,t)||(r.newDebt.amount=t),p(t)}),o()(),i(16,"ion-item")(17,"ion-select",35),S("ngModelChange",function(t){_(e);let r=d();return D(r.newDebt.categoryId,t)||(r.newDebt.categoryId=t),p(t)}),T(18,Re,2,2,"ion-select-option",36,k),o()(),i(20,"ion-item")(21,"ion-label"),s(22,"Due Date"),o(),u(23,"ion-datetime-button",37),o(),i(24,"ion-modal",38),C(25,Ue,1,1,"ng-template"),o(),i(26,"ion-item")(27,"ion-textarea",39),S("ngModelChange",function(t){_(e);let r=d();return D(r.newDebt.description,t)||(r.newDebt.description=t),p(t)}),o()()()()}if(n&2){let e=d();l(8),b("disabled",e.isSaving()),l(),y(e.isSaving()?9:10),l(4),y(e.authService.isAdmin()?13:-1),l(2),x("ngModel",e.newDebt.amount),l(2),x("ngModel",e.newDebt.categoryId),l(),V(e.categories()),l(6),b("keepContentsMounted",!0),l(3),x("ngModel",e.newDebt.description),b("rows",3)}}var st=(()=>{class n{debtService;categoryService;userService;authService;toastController;debts=g([]);filteredDebts=g([]);users=g([]);categories=g([]);isLoading=g(!0);isSaving=g(!1);isModalOpen=g(!1);selectedStatus="all";totalDebt=g(0);pendingDebt=g(0);paidDebt=g(0);currentPage=1;pageSize=20;hasMore=!0;newDebt={userId:0,amount:0,categoryId:0,date:new Date().toISOString(),dueDate:new Date().toISOString(),description:""};constructor(e,a,t,r,m){this.debtService=e,this.categoryService=a,this.userService=t,this.authService=r,this.toastController=m,De({addOutline:Se,walletOutline:Me,closeOutline:Pe,calendarOutline:we,filterOutline:ve,checkmarkCircleOutline:ye})}ngOnInit(){this.loadDebts(),this.loadCategories(),this.authService.isAdmin()&&this.loadUsers()}loadCategories(){this.categoryService.getAll().subscribe({next:e=>{e.success&&e.data&&this.categories.set(e.data.filter(a=>a.type==="Debt"))}})}loadUsers(){this.userService.getAll().subscribe({next:e=>{e.success&&e.data&&this.users.set(e.data)}})}loadDebts(e=!1){e||(this.isLoading.set(!0),this.currentPage=1),this.debtService.getMyDebts().subscribe({next:a=>{if(a.success&&a.data){let t=a.data;e?this.debts.update(r=>[...r,...t]):(this.debts.set(t),this.calculateTotals(t)),this.hasMore=!1,this.applyFilter()}this.isLoading.set(!1)},error:()=>{this.isLoading.set(!1)}})}calculateTotals(e){let a=e.reduce((m,I)=>m+I.amount,0),t=e.filter(m=>m.status==="Pending").reduce((m,I)=>m+I.amount,0),r=e.filter(m=>m.status==="Paid").reduce((m,I)=>m+I.amount,0);this.totalDebt.set(a),this.pendingDebt.set(t),this.paidDebt.set(r)}applyFilter(){this.selectedStatus==="all"?this.filteredDebts.set(this.debts()):this.filteredDebts.set(this.debts().filter(e=>e.status===this.selectedStatus))}onStatusChange(){this.applyFilter()}loadMore(e){e.target.complete()}refresh(e){this.loadDebts(),setTimeout(()=>{e.target.complete()},1e3)}getStatusColor(e){switch(e){case"Paid":return"success";case"Pending":return"warning";case"Overdue":return"danger";default:return"medium"}}openAddModal(){this.resetNewDebt(),this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1)}resetNewDebt(){this.newDebt={userId:0,amount:0,categoryId:0,date:new Date().toISOString(),dueDate:new Date().toISOString(),description:""}}saveDebt(){return h(this,null,function*(){if(!this.newDebt.amount){yield(yield this.toastController.create({message:"Please enter an amount",duration:2e3,color:"warning"})).present();return}if(!this.newDebt.categoryId){yield(yield this.toastController.create({message:"Please select a category",duration:2e3,color:"warning"})).present();return}if(this.authService.isAdmin()&&!this.newDebt.userId){yield(yield this.toastController.create({message:"Please select a member",duration:2e3,color:"warning"})).present();return}this.isSaving.set(!0),this.debtService.create({userId:this.newDebt.userId||this.authService.currentUser()?.id||0,amount:this.newDebt.amount,categoryId:this.newDebt.categoryId,date:new Date(this.newDebt.date),dueDate:new Date(this.newDebt.dueDate),description:this.newDebt.description}).subscribe({next:e=>h(this,null,function*(){this.isSaving.set(!1),e.success&&(this.closeModal(),this.loadDebts(),yield(yield this.toastController.create({message:"Debt added successfully",duration:2e3,color:"success"})).present())}),error:()=>h(this,null,function*(){this.isSaving.set(!1),yield(yield this.toastController.create({message:"Failed to add debt",duration:2e3,color:"danger"})).present()})})})}markAsPaid(e){return h(this,null,function*(){this.debtService.updateStatus(e.id,"Paid").subscribe({next:a=>h(this,null,function*(){a.success&&(this.loadDebts(),yield(yield this.toastController.create({message:"Debt marked as paid",duration:2e3,color:"success"})).present())}),error:()=>h(this,null,function*(){yield(yield this.toastController.create({message:"Failed to update debt status",duration:2e3,color:"danger"})).present()})})})}static \u0275fac=function(a){return new(a||n)(w(Ie),w(Ee),w(Oe),w(xe),w(ge))};static \u0275cmp=B({type:n,selectors:[["app-debts"]],decls:50,vars:12,consts:[["slot","start"],[3,"ngModelChange","ionChange","ngModel"],["value","all"],["value","Pending"],["value","Paid"],[1,"ion-padding"],["slot","fixed",3,"ionRefresh"],[1,"summary-card"],[1,"summary-content"],[1,"summary-item"],[1,"label"],[1,"value","danger"],[1,"value","warning"],[1,"value","success"],[1,"loading-container"],[1,"empty-state"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click"],["name","add-outline"],[3,"didDismiss","isOpen"],["name","crescent"],["name","wallet-outline"],[3,"ionInfinite"],["name","wallet-outline","slot","start",3,"color"],[1,"meta"],["name","calendar-outline"],["slot","end",1,"action-buttons"],[3,"color"],["fill","clear","size","small"],["fill","clear","size","small",3,"click"],["slot","icon-only","name","checkmark-circle-outline"],["slot","icon-only","name","close-outline"],["slot","end"],[3,"click","disabled"],["type","number","label","Amount","labelPlacement","floating","placeholder","Enter amount",3,"ngModelChange","ngModel"],["label","Category","labelPlacement","floating","placeholder","Select category",3,"ngModelChange","ngModel"],[3,"value"],["datetime","debt-due-date"],[3,"keepContentsMounted"],["label","Description","labelPlacement","floating","placeholder","Add a description (optional)",3,"ngModelChange","ngModel","rows"],["label","Member","labelPlacement","floating","placeholder","Select member",3,"ngModelChange","ngModel"],["id","debt-due-date","presentation","date",3,"ngModelChange","ngModel"]],template:function(a,t){a&1&&(i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),u(3,"ion-menu-button"),o(),i(4,"ion-title"),s(5,"My Debts"),o()(),i(6,"ion-toolbar")(7,"ion-segment",1),S("ngModelChange",function(m){return D(t.selectedStatus,m)||(t.selectedStatus=m),m}),f("ionChange",function(){return t.onStatusChange()}),i(8,"ion-segment-button",2)(9,"ion-label"),s(10,"All"),o()(),i(11,"ion-segment-button",3)(12,"ion-label"),s(13,"Pending"),o()(),i(14,"ion-segment-button",4)(15,"ion-label"),s(16,"Paid"),o()()()()(),i(17,"ion-content",5)(18,"ion-refresher",6),f("ionRefresh",function(m){return t.refresh(m)}),u(19,"ion-refresher-content"),o(),i(20,"div",7)(21,"ion-card")(22,"ion-card-content")(23,"div",8)(24,"div",9)(25,"span",10),s(26,"Total Debt"),o(),i(27,"span",11),s(28),M(29,"currency"),o()(),i(30,"div",9)(31,"span",10),s(32,"Pending"),o(),i(33,"span",12),s(34),M(35,"currency"),o()(),i(36,"div",9)(37,"span",10),s(38,"Paid"),o(),i(39,"span",13),s(40),M(41,"currency"),o()()()()()(),C(42,Te,4,0,"div",14)(43,Be,7,1,"div",15)(44,Le,5,0),i(45,"ion-fab",16)(46,"ion-fab-button",17),f("click",function(){return t.openAddModal()}),u(47,"ion-icon",18),o()(),i(48,"ion-modal",19),f("didDismiss",function(){return t.closeModal()}),C(49,He,28,8,"ng-template"),o()()),a&2&&(l(7),x("ngModel",t.selectedStatus),l(21),v(E(29,6,t.totalDebt())),l(6),v(E(35,8,t.pendingDebt())),l(6),v(E(41,10,t.paidDebt())),l(2),y(t.isLoading()&&t.debts().length===0?42:t.filteredDebts().length===0?43:44),l(6),b("isOpen",t.isModalOpen()))},dependencies:[z,A,L,R,N,j,$,ue,me,K,G,J,oe,ne,ie,pe,H,Y,de,re,le,q,ae,X,Z,U,be,he,Ce,ce,_e,Q,ee,te,fe,se],styles:[".summary-card[_ngcontent-%COMP%]{margin-bottom:16px}.summary-card[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{margin:0}.summary-content[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.summary-item[_ngcontent-%COMP%]{text-align:center}.summary-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;font-size:12px;color:var(--ion-color-medium);margin-bottom:4px}.summary-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:18px;font-weight:700}.summary-item[_ngcontent-%COMP%]   .value.danger[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.summary-item[_ngcontent-%COMP%]   .value.warning[_ngcontent-%COMP%]{color:var(--ion-color-warning)}.summary-item[_ngcontent-%COMP%]   .value.success[_ngcontent-%COMP%]{color:var(--ion-color-success)}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:var(--ion-color-medium);margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0}ion-item[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:12px;margin-top:4px}ion-item[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:4px}"]})}return n})();export{st as DebtsPage};
