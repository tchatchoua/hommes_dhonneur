import{M as a,S as u,W as g,a as n,c,d as i,e as l,eb as o,f as s,j as h}from"./chunk-CLQQFUUR.js";var K=(()=>{class r{http;router;apiUrl=`${o.apiUrl}/auth`;TOKEN_KEY="access_token";REFRESH_TOKEN_KEY="refresh_token";USER_KEY="user";currentUserSignal=h(this.getStoredUser());currentUser=this.currentUserSignal.asReadonly();isAuthenticated=a(()=>!!this.currentUserSignal());isAdmin=a(()=>this.currentUserSignal()?.role==="Admin");constructor(t,e){this.http=t,this.router=e}login(t){return this.http.post(`${this.apiUrl}/login`,t).pipe(i(e=>{e.success&&e.data&&this.handleAuthSuccess(e.data)}))}register(t){return this.http.post(`${this.apiUrl}/register`,t).pipe(i(e=>{e.success&&e.data&&this.handleAuthSuccess(e.data)}))}validateInvitation(t){return this.http.get(`${this.apiUrl}/validate-invitation/${t}`)}changePassword(t){return this.http.post(`${o.apiUrl}/users/me/change-password`,t)}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.currentUserSignal.set(null),this.router.navigate(["/auth/login"])}getToken(){return localStorage.getItem(this.TOKEN_KEY)}refreshToken(){let t=localStorage.getItem(this.REFRESH_TOKEN_KEY);return this.http.post(`${this.apiUrl}/refresh`,{refreshToken:t}).pipe(i(e=>{e.success&&e.data&&this.handleAuthSuccess(e.data)}),c(()=>(this.logout(),n({success:!1}))))}updateCurrentUser(t){localStorage.setItem(this.USER_KEY,JSON.stringify(t)),this.currentUserSignal.set(t)}handleAuthSuccess(t){localStorage.setItem(this.TOKEN_KEY,t.accessToken),localStorage.setItem(this.REFRESH_TOKEN_KEY,t.refreshToken),localStorage.setItem(this.USER_KEY,JSON.stringify(t.user)),this.currentUserSignal.set(t.user)}getStoredUser(){let t=localStorage.getItem(this.USER_KEY);if(t)try{return JSON.parse(t)}catch{return null}return null}static \u0275fac=function(e){return new(e||r)(s(u),s(g))};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();export{K as a};
